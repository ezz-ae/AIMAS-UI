Codex Run Log — 2025-12-15
-------------------------

## Task 001 – Wire AIMAS authority repo into AIMAS-UI
- Verified `vendor/aimas` submodule + `AIMAS_DOCS_PATH` override handling in `lib/docs.ts` and README instructions.
- No new changes required.

## Task 002 – Deterministic doc registry loader
- Confirmed `lib/docs.ts` builds registry, enforces section coverage, and honors overrides.
- No new changes required.

## Task 003 – /docs routing
- Checked `app/docs/page.tsx` + `app/docs/[...slug]/page.tsx` render registry output only.
- No new changes required.

## Task 004 – Docs UI polish
- Validated typography + metadata display (counts, source paths, toc) already implemented in docs pages.
- No new changes required.

## Task 005 – Search index
- Ensured `lib/search/*`, `scripts/build-search.ts`, and `scripts/docs-verify.ts` satisfy requirements.
- Build + docs:verify already enforced in package scripts/CI.

## Task 006 – Landing proves without saying
- Verified `/` uses search-only GateSearch, `/search` hosts intent input + doc results + system transition.
- No new changes required.

## Task 007 – Protocol dashboard (/system)
- Confirmed `/system` renders deterministic Input → Capsule → Fit Matrix → Paths visualization with optional `intent` query and highlights the Free Baseline Path.
- No new changes required.

## Task 008 – OpenAPI viewer
- Strengthened `scripts/docs-verify.ts` so builds fail when `openapi.(yaml|yml|json)` is missing unless `AIMAS_ALLOW_MISSING_OPENAPI=1` is explicitly set.
- Updated `README.md` to document the OpenAPI enforcement + override.

## Task 009 – Cloud Run contract
- Extended `apps/api` server with `/v1/status` emitting version + commit metadata sourced from env vars.
- Refreshed `AIMAS/apps/api/README.md` and `AIMAS/cloudrun/README.md` with the new contract, env requirements, and fairness notes.

## Task 010 – CI guardrails
- Documented the existing `.github/workflows/verify.yml` ritual in `README.md`, clarifying the zero-drift + OpenAPI enforcement performed in CI.

## Task 011 – Protocol shell UX + API binding
- Added `/codex/tasks/011-protocol-shell-ux.md` and rebuilt the UI shell with `components/shell/ShellLayout` (sidebar, topbar, API status) + dark theme.
- Landing `/` remains search-only and now routes directly to `/system?q=…`; `/system` uses the new shell, pre-fills intake from `q`, and posts to `${NEXT_PUBLIC_AIMAS_API_BASE}/fit` with deterministic fallback output.
- Docs (`/docs/*`) and `/api` now render inside the shell; `/api` includes copyable curl snippets powered by `.env.example` (NEXT_PUBLIC_AIMAS_API_BASE / AIMAS_DOCS_PATH).
- Added `/system` dashboard client logic, API status indicator, OpenAPI enforcement messaging, `.env.example`, and README updates describing the binding contract.

## Task 009 (hardening) – Cloud Run contract
- Added GET `/`, `/readyz`, `/livez`, and `/openapi.yaml` to `apps/api/src/index.ts`, ensured CORS may be limited via `CORS_ORIGIN`, and updated `openapi.yaml` servers + paths to match the deployed Cloud Run URL.
- Refreshed `AIMAS/apps/api/README.md` + `AIMAS/cloudrun/README.md` so ops teams know about the new probes/spec endpoint.

## Task 012 – Wire AIMAS-UI to AIMAS API
- `/system` now uses the full protocol pipeline: `/api/adapter/normalize` → `${NEXT_PUBLIC_AIMAS_API_BASE}/v1/intent` → `/v1/fit/{intent_id}` with deterministic fallback when API fails.
- ShellLayout powers `/system`, `/docs`, `/api`, `/search`, and Landing `/` now routes intent straight into `/system?q=…`.

## Task 011 – OpenAI normalize adapter
- Added `app/api/adapter/normalize/route.ts` (server-only) using OpenAI + zod to convert L0 text into feature-only capsules without logging raw input.
- `.env.example` documents `NEXT_PUBLIC_AIMAS_API_BASE` and `OPENAI_API_KEY`, and `.gitignore` blocks `.env*` to prevent secret leaks.

## Task 010 (expanded) – CI guardrails
- Added `scripts/check-secrets.mjs` + `pnpm check:secrets` (wired into GitHub Actions) to fail if any tracked file contains an `sk-…` secret.
- Workflow now runs docs:verify → check:secrets → lint → build, keeping zero-drift + zero-leakage enforcement automated.
- `lib/docs.ts` gained a fallback so `docs:verify` prefers `vendor/aimas` but will switch to `AIMAS/` when the submodule lacks OpenAPI, avoiding false negatives.
